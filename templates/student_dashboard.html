<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة تحكم الطالب - {{ student_name }}</title>
    <style>
        body { font-family: 'Tahoma', sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; padding: 30px; }
        h1 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 5px; margin-bottom: 20px; }
        h2 { color: #555; font-size: 1.5em; margin-bottom: 25px; }
        .logout-link { float: left; margin-top: -45px; font-size: 0.9em; text-decoration: none; color: #007bff; }

        /* --- 1. تصميم بطاقات KPI (مثل الصورة الثانية) --- */
        .kpi-row { display: flex; justify-content: space-between; gap: 20px; margin-bottom: 40px; }
        .kpi-card {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            flex-basis: 30%;
            position: relative;
            overflow: hidden;
        }
        .kpi-card h3 { font-size: 3em; margin: 0; font-weight: 700; }
        .kpi-card p { font-size: 1.1em; color: #666; margin-top: 5px; }
        
        /* مؤشرات الألوان على الحدود */
        .kpi-card.blue { border-top: 5px solid #007bff; }
        .kpi-card.green { border-top: 5px solid #28a745; }
        .kpi-card.orange { border-top: 5px solid #ffc107; }

        /* --- 2. تصميم المهام (مثل الصورة الأولى) --- */
        .segments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .segment-item {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 15px;
            border-right: 5px solid; /* سيتم تعيين اللون بالكلاس */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .segment-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .segment-meta {
            font-size: 0.85em;
            color: #777;
            margin-bottom: 15px;
        }
        
        .status-badge { 
            font-weight: bold; 
            padding: 4px 10px; 
            border-radius: 4px; 
            font-size: 0.8em;
            align-self: flex-start;
        }
        
        /* ألوان الحالات */
        .status-Accepted { background-color: #d4edda; color: #155724; border-color: #28a745; }
        .status-New { background-color: #cce5ff; color: #004085; border-color: #007bff; }
        .status-Pending { background-color: #fff3cd; color: #856404; border-color: #ffc107; }
        .status-Rejected { background-color: #f8d7da; color: #721c24; border-color: #dc3545; }

        /* ألوان حدود البطاقة (المقاطع) */
        .segment-item.s-accepted { border-right-color: #28a745; }
        .segment-item.s-new, .segment-item.s-rejected { border-right-color: #007bff; }
        .segment-item.s-pending { border-right-color: #ffc107; }

        /* الأزرار في أسفل البطاقة */
        .segment-actions-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        .submit-btn { 
            background-color: #007bff; 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            cursor: pointer; 
            border-radius: 5px; 
            font-size: 0.9em;
        }
        .submit-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>مرحباً بك يا {{ student_name }}!</h1>
        <a href="{{ url_for('logout') }}" class="logout-link">تسجيل الخروج</a>
        
        <div class="kpi-row">
            <div class="kpi-card blue">
                <h3>450</h3>
                <p>مجموع النقاط</p>
                </div>
            <div class="kpi-card green">
                <h3>85%</h3>
                <p>معدل النجاح</p>
                </div>
            <div class="kpi-card orange">
                <h3>70%</h3>
                <p>نسبة الإنجاز</p>
                </div>
        </div>
        
        <h2>منهج الحفظ والمراجعة</h2>
        
        <div class="segments-grid">
            {% for segment in segments %}
                {% set status = status_map.get(segment.id, 'New') %}
                
                <div class="segment-item s-{{ status.lower() }}">
                    <div>
                        <span class="status-badge status-{{ status }}">{{ status }}</span>
                        <div class="segment-title">
                            المقطع {{ segment.segment_order }}: {{ segment.name }}
                        </div>
                        <div class="segment-meta">
                            من سورة {{ segment.sura_start }} آية {{ segment.aya_start }} إلى سورة {{ segment.sura_end }} آية {{ segment.aya_end }}
                        </div>
                    </div>
                    
                    <div class="segment-actions-bottom">
                        <div>
                            <small style="color:#999;">نقاط التقييم: 30</small>
                        </div>
                        
                        {% if status == 'Pending' %}
                            <button class="submit-btn" disabled>معلق</button>
                        {% else %}
                            <form method="POST" action="{{ url_for('submit_progress') }}">
                                <input type="hidden" name="segment_id" value="{{ segment.id }}">
                                <button type="submit" class="submit-btn">إرسال حفظ</button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>

    </div>
</body>
</html>